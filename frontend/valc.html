<!DOCTYPE html>
<html lang="en">

<head>
    <title>Light Curves Viewer - VALC</title>

    <link rel="stylesheet" href="styles.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Readex+Pro:wght@200;300;400;500&display=swap"
          rel="stylesheet">

    <script src='https://cdn.plot.ly/plotly-2.6.3.min.js'></script>
</head>

<body>
<div class="container">
    <div class="left_side">
        <div class="menu">
            <a class="logo_header" href="fulu.html">
                FULU
            </a><a class="logo_header logo_header_active" href="valc.html">
            VALC
        </a>
        </div>
        <div class="info">
            <div class="arrow arrow_right"></div>
            <span><b>Choose name from the list below &#8595;</b></span>
        </div>
        <input type="text" id="name_input" placeholder="Search.."
               oninput="onSearch()">
        <div id="all_names"></div>
    </div>
    <div class="right_side">
        <div id="data">
            <h2 id="name_header"></h2>
            <div id="params" class="div-table"></div>
            <div id="images"></div>
        </div>

        <div id="description">
            <h2>VALC</h2>
            <p>
                VALC is Python package, which is devoted to post-processing of
                ZTF Forced
                Photometry light curves and conducting statistical test to
                reject the hypothesis of a
                constant with white noise. The purpose of the work in
                confirmation of the presence
                of active galactic nuclei (AGN) type-1 in the host galaxies of
                candidates. Tests of the
                algorithm was provided on a sample of AGN, powered by
                intermediate mass black
                holes (IMBH; M < 2*10^5 M&#9737;) and low-weighted supermassive
                black
                holes
                (LWSMBH; M < 2*10^6 M&#9737;).
                Post-processing includes outlier filtering, color correction
                and zero-point correction.
                The key advantage of the algorithm is the subtraction magnitude
                of the median
                comparison star, which is exstracted from 50 nearest
                non-variable stars. [1,2].
            </p>
            <p>
                [1]Demianenko M. et al., "Optical Variability of "Light-weight"
                Supermassive Black
                Holes at a Few Percent Level from ZTF Forced-Photometry Light
                Curves",
                Proceedings of ADASS-2021 conference, 2022,
                <a href="https://arxiv.org/abs/2201.03712">https://arxiv.org/abs/2201.03712</a>
            </p>
            <p>
                [2]Demianenko M. et al., "Optical light curves of light-weight
                supermassive black holes produced by the Zwicky Transient
                Facility Forced Photometry Service", Proceedings of VAK-2021
                conference, 2021, <a href="https://arxiv.org/abs/2112.11520">https://arxiv.org/abs/2112.11520</a>
            <p>
                <a href="https://github.com/masha-astro/optical_variability_ztf">https://github.com/masha-astro/optical_variability_ztf</a>
            </p>
            <p>
            <h3>Parameters:</h3>
            <div class="div-table">
                <div class="div-table-row">
                    <div class="div-table-col">name</div>
                    <div class="div-table-col">name of the object</div>
                </div>
                <div class="div-table-row">
                    <div class="div-table-col">Statistics</div>
                    <div class="div-table-col">comments about X-ray data lowmass_allxray_1908.fits</div>
                </div>
                <div class="div-table-row">
                    <div class="div-table-col">ra, dec</div>
                    <div class="div-table-col">object coordinates</div>
                </div>
                <div class="div-table-row">
                    <div class="div-table-col">MBH</div>
                    <div class="div-table-col">Mass Black Hole from 'results_emis_fit2d_ESI.fits' <br/>& 'results_emis_fit2d_MagE.fits'</div>
                </div>
                <div class="div-table-row">
                    <div class="div-table-col">L_X; NH; Gamma</div>
                    <div class="div-table-col">luminosity and parameters of the X-ray data if there is</div>
                </div>
                <div class="div-table-row">
                    <div class="div-table-col">source</div>
                    <div class="div-table-col">source of the X-ray data</div>
                </div>
                <div class="div-table-row">
                    <div class="div-table-col">rcsed</div>
                    <div class="div-table-col">search in rcsed2</div>
                </div>
                <div class="div-table-row">
                    <div class="div-table-col">page.html</div>
                    <div class="div-table-col">page with spectrum and other data if there is</div>
                </div>
                <div class="div-table-row">
                    <div class="div-table-col">Table from</div>
                    <div class="div-table-col">table from which the information is taken: <br/>lowmass_allxray_1908.fits; <br/>results_emis_fit2d_ESI.fits; <br/>results_emis_fit2d_MagE.fits</div>
                </div>
            </div>
            </p>
        </div>
    </div>
</div>
</body>

<script>

    const HOST = '/api'
    // const HOST = 'http://84.201.157.77:7001/api'

    let NAMES = []

    //rounding to exponencial form of number
    function expo(x, f) {
        return Number.parseFloat(x).toExponential(f);
    }
    function round(x, f) {
        return Number.parseFloat(x).toFixed(f);
    }
    function show_exp(obj) {
        var obj2 = []
        for (x of Object.values(obj)){
            obj2.push( expo(x,2))
        }
        return obj2
    }
    function show_fix(obj) {
        var obj2 = []
        for (x of Object.values(obj)){
            obj2.push( round(x,2))
        }
        return obj2
    }

    function request(url, callback) {
        let xhr = new XMLHttpRequest()
        xhr.onload = function () {
            if (xhr.status === 200) {
                callback(xhr.response)
            } else {
                console.error(`Error ${xhr.status}: ${xhr.statusText}`)
            }
        }
        xhr.open('GET', url, true)
        xhr.responseType = 'json'
        xhr.send(null)
    }

    function show_all_names(names) {
        document.getElementById('all_names').innerHTML = names.map(
            name => `<span class="name" onclick="onNameClick('${name}')">${name}</span>`,
        ).reduce(
            (a, b) => a + b, '',
        )
    }

    function save_response_names(names) {
        NAMES = names
        show_all_names(names)
    }

    function plot(data) {
    }

    function show_params(data) {
        let innerHTML = ''
        for (const [param, value] of Object.entries(data.params)) {
            if (!value) continue
            let col_value = value
            if (param === 'Statistics' || param === 'source') {
                col_value = Object.values(value).map(stat => `<li>${stat}</li>`).reduce(
                    (a, b) => a + b, '',
                )
                col_value = `<ol class="params_list">${col_value}</ol>`
            }
            if (param === 'rcsed' || param === 'page.html' || param === 'page_all_fit') {
                col_value = `<a href="${value}">${value}</a>`
            }
            if (param === 'L_X'|| param === 'MBH' || param === 'MBH_ESI' || param === 'MBH_MagE' || param === 'NH') {
                col_value = show_exp(value)
                col_value = `<ol class="params_list">${col_value}</ol>`
            }//rounding to exponencial form of number 
            if (param === 'Gamma') {
                col_value = show_fix(value)
                col_value = `<ol class="params_list">${col_value}</ol>`
            }//rounding to fixed number after point 
            innerHTML += `<div class="div-table-row">
                <div class="div-table-col">${param}</div>
                <div class="div-table-col">${col_value}</div>
            </div>`
        }
        document.getElementById('params').innerHTML = innerHTML
    }

    function show_images(data) {
        let innerHTML = ''
        for (const image_url of data.images || []) {
            innerHTML += `<img src="${image_url}" alt=""/>`
        }
        document.getElementById('images').innerHTML = innerHTML
    }

    function onNameClick(name) {
        document.getElementById('name_header').textContent = name
        request(`${HOST}/data/VALC/${name}`, data => {
            plot(data)
            show_params(data)
            show_images(data)
        })
        document.getElementById('description').style.display = 'none'
        document.getElementById('data').style.display = 'block'
    }

    function onSearch(pattern) {
        const filtered_names = NAMES.filter(name => name.toLowerCase().includes(pattern.toLowerCase()))
        show_all_names(filtered_names)
    }

    let name_input = document.getElementById('name_input')
    name_input.oninput = function () {
        onSearch(name_input.value)
    }

    request(`${HOST}/names-valc`, names => save_response_names(names))

</script>

</html>

